# GATK4-CNV-Pipeline
Copy Number Variation Analysis for Cancer RNA-Seq Data

This project implements a fully reproducible workflow for computing copy number variations (CNVs) from large-scale dbGaP/GDC RNA-seq cohorts using GATK4.  
The workflow is organized into three phases: pre-processing (SRA → FASTQ → BAM), CNV processing (GATK CNV tools), and post-processing (gene-level CNV matrix + survival analysis).

The pipeline is designed to scale on HPC (Slurm) systems and supports downstream statistical and clinical analyses.

---

## Pre-Processing Workflow

- Download and verify SRA accessions  
- Extract FASTQ files using fasterq-dump (scratch-based execution)  
- Align FASTQ files with BWA-mem2  
- Sort and index BAM files using samtools  
- Perform QC and metadata preparation (Python + Jupyter)

Folder: workflow/01-pre_processing

Files:
- 01_pre.sh  
- 02_pre.sh  
- 03_pre.py  
- 04_pre.ipynb  

---

## CNV Processing (GATK4)

- CollectReadCounts for tumor and normal samples  
- Build a Panel of Normals (CreateReadCountPanelOfNormals)  
- Apply DenoiseReadCounts using the PoN  
- Segment genomes using ModelSegments  
- Export CNV segments and copy-ratio files

Folder: workflow/02-processing

Files:
- 01_main.sh  
- 02_main.sh  
- 03_main.sh  
- 04_main.sh  
- 05_main.sh  
- 06_main.sh  
- 07_main.sh  
- 08_main.sh  

---

## Post-Processing & Analysis

- Map CNV segments to gene coordinates (R)  
- Generate gene-level CNV matrices for cohort-level analysis  
- Perform survival analysis (Kaplan–Meier, Cox models) in Jupyter notebooks

Folder: workflow/03-post_processing

Files:
- main_01.R  
- main_02.R  
- survival_analysis.ipynb  

---

## Project Structure

workflow/  
    01-pre_processing/  
    02-processing/  
    03-post_processing/  

Each stage is modular and can be executed independently on an HPC cluster.

---

## Requirements

Software:
- GATK 4.x  
- BWA-mem2  
- samtools  
- SRA Toolkit  
- Python 3.9+  
- R 4.0+  
- Slurm HPC environment  

R packages:
- dplyr  
- data.table  
- GenomicRanges  
- readr  

Python packages:
- pandas  
- numpy  

---

## Outputs

- Denoised copy-ratio files  
- CNV segmentation tables  
- Gene-level CNV matrix  
- Survival analysis figures and summaries  

---

## Notes

- Workflow is compatible with dbGaP-compliant secure environments  
- Interval lists must remain consistent across samples  
- Scratch directories should be adjusted based on HPC configuration  
